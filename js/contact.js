var translations,lang;if(!window.jQuery){var jq=document.createElement('script');jq.type='text/javascript';jq.src='contact-form/assets/js/jquery.min.js';document.getElementsByTagName('head')[0].appendChild(jq);}jQuery.getJSON('contact-form/translations.json',function(json){translations=json;lang=json.default_lang;window.console.log('translations:',json);});function parseMessage(str,vars){var i,pattern,re,n=vars.length;for(i=0;i<n;i++){pattern="\\{\\$"+(i+1)+"\\}";re=new RegExp(pattern,"g");str=str.replace(re,vars[i]);}return str;}function showMessageBox($msg,html){$msg.slideUp('slow',function(){$(this).html(html).slideDown('slow');});}function getErrorsHtml(errors){var errors_string='';errors_string+='<div class="errors">';errors_string+='<p>'+translations.form.error.title[lang]+'</p>';errors_string+='<ul>';for(var i=0;i<errors.length;i++){errors_string+='<li>'+errors[i]+'</li>';}errors_string+='</ul>';errors_string+='</div>';return errors_string;}function getSuccessHtml(success){var success_string='';success_string+='<div class="success">';success_string+='<p>'+success+'</p>';success_string+='</div>';return success_string;}function validateTheField($field){var type=$field.prop('type'),name=$field.prop('name'),val=$field.val(),msg;if($field.prop('required')&&$field.val()===''){msg=parseMessage(translations.form.error.required[lang],[name]);return msg;}switch(type){case'email':var aPos=val.indexOf("@"),dPos=val.lastIndexOf(".");if(aPos<1||dPos<aPos+2||dPos+2>=val.length){msg=parseMessage(translations.form.error.email[lang],[name]);return msg;}break;case'tel':case'number':if(!$.isNumeric(val)){msg=parseMessage(translations.form.error.numeric[lang],[name]);return msg;}break;}}function validateTheForm($form){var errors=[],passed=true,$msg=$form.find('.message'),html;$form.find('[required]').each(function(i){var err=validateTheField($(this));if(err){errors.push(err);}});if(errors.length){passed=false;html=getErrorsHtml(errors);showMessageBox($msg,html);}return passed;}function resetFormButton($submit,submit_text){jQuery('<button class="button secondary">'+translations.form.reset[lang]+'</button>').insertAfter('.button.primary').click(function(e){e.preventDefault();grecaptcha.reset();jQuery('input.field, textarea.field').val('');jQuery('select.field').select2('val','');jQuery(this).fadeOut('slow',function(){jQuery(this).remove();$submit.text(submit_text).removeClass('complete').removeAttr('disabled');});});}function recaptchaCallback(){console.log('resetting google recaptcha');grecaptcha.reset();}jQuery(document).ready(function($){$('form.ucf').each(function(){var $form=$(this),$msg=$form.find('.message'),$submit=$form.find('button[type=submit]'),submit_txt=$submit.text(),action=$form.prop('action'),data;$msg.fadeOut(0);$form.submit(function(e){e.preventDefault();if(validateTheForm($form)){window.console.log('js validation complete, starting ajax request');data=new FormData($form[0]);$submit.text(translations.form.button_text[lang]).attr('disabled','disabled');$.ajax({url:action,type:'POST',data:data,processData:false,contentType:false,}).done(function(data){if(data.substring(0,1)!=="{"){showMessageBox($msg,'<p>'+translations.form.error.title[lang]+'</p>');window.console.log(data);return;}data=$.parseJSON(data);if(data.errors){showMessageBox($msg,getErrorsHtml(data.errors));$submit.text(submit_txt).removeAttr('disabled');}if(data.success){showMessageBox($msg,getSuccessHtml(translations.form.success.title[lang]));$submit.text(translations.form.success.button_text[lang]).attr('disabled','disabled').addClass('complete');resetFormButton($submit,submit_txt);}if(data.redirect){window.location.href=data.redirect;}}).fail(function(data){showMessageBox($msg,'<p>'+translations.form.error.title[lang]+'</p>');$submit.text(submit_txt).removeAttr('disabled');});}});});$('select').select2();});